"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _get(e,t,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=_superPropBase(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(i):a.value}})(e,t,i||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var AppStore=function(){function e(){_classCallCheck(this,e),this.state={},this.listeners=[],this.methods={},window._store=this}return _createClass(e,[{key:"addListener",value:function(e,t){t?(this.methods[t]||(this.methods[t]=[]),this.methods[t].push(e)):this.listeners.push(e)}},{key:"removeListener",value:function(e,t){if(t){if(this.methods[t]){var i=this.methods[t].indexOf(e);-1!==i&&this.methods[t].splice(i,1)}}else{var n=this.listeners.indexOf(e);-1!==n&&this.listeners.splice(n,1)}}},{key:"set",value:function(n,a){if(void 0===n)throw new Error("AppStore requires legit keys");this.state[n]=a,this.listeners.forEach(function(e,t,i){e.storeUpdated(n,a)});var e=this.methods[n];e&&e.forEach(function(e){if(!e[n])throw new Error("AppStore listener has no callback: "+n);e[n](a)})}},{key:"get",value:function(e){return this.state[e]}},{key:"log",value:function(){for(var e in _store.state)console.log(e,_store.state[e])}}]),e}(),AppStoreDebug=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];_classCallCheck(this,t),this.showing=e,this.buildElement(),_store.addListener(this),this.initKeyListener()}return _createClass(t,[{key:"initKeyListener",value:function(){var t=this;window.addEventListener("keyup",function(e){32==(e.keyCode?e.keyCode:e.which)&&(t.showing=!t.showing),0==t.showing?(t.container.innerHTML="",t.container.style.display="none"):(t.printStore(),t.container.style.display="block")})}},{key:"buildElement",value:function(){this.container=document.createElement("div"),this.container.style.cssText="font-family:arial;font-size:12px;position:fixed;top:0;left:0;padding:12px;height:100%;overflow-y:auto;opacity:0.9;z-index:9999;background:rgba(0,0,0,0.8);color:#fff !important;",document.body.appendChild(this.container),this.container.style.display="none"}},{key:"storeUpdated",value:function(e,t){this.showing&&this.printStore()}},{key:"printStore",value:function(){var e="<table>";for(var t in _store.state){var i=_store.state[t];i&&"object"==_typeof(i)&&i.length&&0<i.length&&(i="Array(".concat(i.length,")")),e+="<tr><td>".concat(t,"</td><td>").concat(i,"</td></tr>")}e+="</table>",this.container.innerHTML=e}}]),t}(),AppStoreDistributed=function(){function r(e){var t;return _classCallCheck(this,r),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this))).socketServerUrl=e,t.solidSocket=new SolidSocket(e),t.solidSocket.setOpenCallback(function(e){return t.onOpen(e)}),t.solidSocket.setMessageCallback(function(e){return t.onMessage(e)}),t}return _inherits(r,AppStore),_createClass(r,[{key:"onOpen",value:function(){console.log("AppStoreDistributed connected to "+this.socketServerUrl),this.set(r.CONNECTED,this.socketServerUrl)}},{key:"onMessage",value:function(e){var t=JSON.parse(e.data);t.store&&t.type?this.set(t.key,t.value):this.set("json",t)}},{key:"set",value:function(e,t,i){if(_get(_getPrototypeOf(r.prototype),"set",this).call(this,e,t),i){var n="number";"boolean"==typeof t&&(n="boolean"),"string"==typeof t&&(n="string");var a={key:e,value:t,store:!0,type:n};this.solidSocket.sendMessage(JSON.stringify(a))}}},{key:"broadcastJson",value:function(e){this.solidSocket.sendMessage(JSON.stringify(e))}}]),r}();AppStoreDistributed.CONNECTED="AppStoreDistributed_CONNECTED";var ArrayUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"removeElement",value:function(e,t){var i=e.indexOf(t);return-1!==i?e.splice(i,1):null}},{key:"clear",value:function(e){e.splice(0,e.length)}},{key:"shuffle",value:function(e){e.sort(function(){return.5-Math.random()})}},{key:"randomElement",value:function(e){return e[MathUtil.randRange(0,e.length-1)]}},{key:"moveLastToFirst",value:function(e){e.unshift(e.pop())}},{key:"uniqueArrayCopy",value:function(e){return e.filter(function(e,t,i){return i.indexOf(e)===t})}},{key:"uniqueArrayCopy2",value:function(e){return _toConsumableArray(new Set(e))}},{key:"crossfadeEnds",value:function(e,t){for(var i=1<arguments.length&&void 0!==t?t:.1,n=Math.round(e.length*i),a=(e[e.length-1]+e[0])/2,r=0;r<=n;r++){var s=r/n,o=e.length-n-1+r;e[o]=MathUtil.lerp(e[o],a,s);var l=n-r;e[l]=MathUtil.lerp(e[l],a,s)}}}]),e}(),CanvasFilters=function(){function T(){_classCallCheck(this,T)}return _createClass(T,null,[{key:"createImageData",value:function(e,t){return T.tmpCtx.createImageData(e,t)}},{key:"getCanvasImageData",value:function(e){var t=e.width,i=e.height;return e.getContext("2d").getImageData(0,0,t,i)}},{key:"getCanvasContext",value:function(e){return e.getContext("2d")}},{key:"desaturate",value:function(e){for(var t=T.getCanvasImageData(e),i=t.data,n=0;n<i.length;n+=4){var a=(i[n]+i[n+1]+i[n+2])/3;i[n]=a,i[n+1]=a,i[n+2]=a}T.getCanvasContext(e).putImageData(t,0,0)}},{key:"saturation",value:function(e,t){t*=-1;for(var i=T.getCanvasImageData(e),n=i.data,a=0;a<n.length;a+=4){var r=Math.max(n[a],n[a+1],n[a+2]);n[a]!=r&&(n[a]+=(r-n[a])*t),n[a+1]!=r&&(n[a+1]+=(r-n[a+1])*t),n[a+2]!=r&&(n[a+2]+=(r-n[a+2])*t)}T.getCanvasContext(e).putImageData(i,0,0)}},{key:"brightness",value:function(e,t){t*=255;for(var i=T.getCanvasImageData(e),n=i.data,a=0;a<n.length;a+=4)n[a]+=t,n[a+1]+=t,n[a+2]+=t;T.getCanvasContext(e).putImageData(i,0,0)}},{key:"contrastImage",value:function(e,t){for(var i=T.getCanvasImageData(e),n=i.data,a=259*(t+255)/(255*(259-t)),r=0;r<n.length;r+=4)n[r]=a*(n[r]-128)+128,n[r+1]=a*(n[r+1]-128)+128,n[r+2]=a*(n[r+2]-128)+128;T.getCanvasContext(e).putImageData(i,0,0)}},{key:"convolute",value:function(e,t,i){for(var n=Math.round(Math.sqrt(t.length)),a=Math.floor(n/2),r=e.data,s=e.width,o=e.height,l=s,u=o,h=T.createImageData(l,u),c=h.data,d=i?1:0,f=0;f<u;f++)for(var v=0;v<l;v++){for(var g=f,m=v,p=4*(f*l+v),k=0,y=0,b=0,C=0,w=0;w<n;w++)for(var x=0;x<n;x++){var S=4*(Math.min(o-1,Math.max(0,g+w-a))*s+Math.min(s-1,Math.max(0,m+x-a))),E=t[w*n+x];k+=r[S]*E,y+=r[1+S]*E,b+=r[2+S]*E,C+=r[3+S]*E}c[p]=k,c[1+p]=y,c[2+p]=b,c[3+p]=C+d*(255-C)}return h}},{key:"sharpen",value:function(e){var t=T.convolute(T.getCanvasImageData(e),[0,-1,0,-1,5,-1,0,-1,0],!1);T.getCanvasContext(e).putImageData(t,0,0)}}]),T}();CanvasFilters.tmpCanvas=document.createElement("canvas"),CanvasFilters.tmpCtx=CanvasFilters.tmpCanvas.getContext("2d");var CanvasUtil=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"hasCanvas",value:function(){return!!document.createElement("canvas").getContext}},{key:"hasWebGL",value:function(){var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}},{key:"getCanvasContext",value:function(e){return e.getContext("2d")}},{key:"drawCircle",value:function(e,t,i,n,a){e.save(),e.beginPath(),e.arc(t,i,n,0,2*Math.PI,!1),e.closePath(),e.stroke(),e.fill(),e.restore()}},{key:"drawArc",value:function(e,t,i,n,a,r,s,o){var l=!(6<arguments.length&&void 0!==s)||s,u=7<arguments.length&&void 0!==o&&o;e.save(),e.beginPath(),l&&e.moveTo(t,i),e.arc(t,i,n,a,r,u),e.closePath(),e.stroke(),e.fill(),e.restore()}},{key:"getImageDataForContext",value:function(e){return e.getImageData(0,0,e.canvas.width,e.canvas.height).data}},{key:"getPixelFromImageData",value:function(e,t,i,n){var a=4*(n*t+i);return[e[a],e[1+a],e[2+a]]}},{key:"getPixelColorFromContext",value:function(e,t,i){var n=e.getImageData(t,i,1,1).data;return[n[0],n[1],n[2]]}},{key:"pixelColorToCanvasColor",value:function(e,t,i){var n=a.getPixelColorFromContext(e,t,i);return a.rgbToCanvasColor(n[0],n[1],n[2],1)}},{key:"loadImageToCanvas",value:function(e,t){var i=new Image;i.crossOrigin="anonymous",i.onload=function(){var e=document.createElement("canvas");e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0),t(e,i)},i.src=e}},{key:"loadImageToContext",value:function(e,i){var n=new Image;n.onload=function(){var e=document.createElement("canvas");e.width=n.width,e.height=n.height;var t=e.getContext("2d");t.drawImage(n,0,0),i(t,n)},n.src=e}},{key:"loadImageToContextFromInput",value:function(t,i){t.addEventListener("change",function(e){i(t.files),e.stopPropagation(),e.preventDefault()})}},{key:"loadImageToContextFromDrop",value:function(t,i){t.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault(),t.classList.add("drop-over")}),t.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()}),t.addEventListener("dragleave",function(e){e.stopPropagation(),e.preventDefault(),t.classList.remove("drop-over")}),t.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),i(e.target.files||e.dataTransfer.files),t.classList.remove("drop-over")},!1)}},{key:"imagesSelected",value:function(e,n){for(var t,i=0;t=e[i];i++){var a=new FileReader;a.onload=function(t){return function(e){document.createElement("span");var i=document.createElement("img");i.src=e.target.result,i.alt=t.name,setTimeout(function(){var e=document.createElement("canvas");e.width=i.width,e.height=i.height;var t=e.getContext("2d");t.drawImage(i,0,0),n(t,i)},300)}}(t),a.readAsDataURL(t)}}},{key:"copyPixels",value:function(e,t,i,n,a,r,s,o,l,u){i=i||0,n=n||0,a=a||e.canvas.width,r=r||e.canvas.height,s=s||0,o=o||0,l=l||e.canvas.width,u=u||e.canvas.height,t.putImageData(e.getImageData(i,n,a,r),s,o,s,o,l,u)}},{key:"saveCanvas",value:function(e){var t=document.createElement("img");t.id="save",document.body.appendChild(t),t.src=e.canvas.toDataURL(),t.width=e.canvas.width/4,t.height=e.canvas.height/4,t.id=""}},{key:"cloneCanvas",value:function(e){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),t}},{key:"textureMap",value:function(e,t,i){for(var n=[[0,1,2],[2,3,0]],a=0;a<2;a++){var r=n[a],s=i[r[0]].x,o=i[r[1]].x,l=i[r[2]].x,u=i[r[0]].y,h=i[r[1]].y,c=i[r[2]].y,d=i[r[0]].u,f=i[r[1]].u,v=i[r[2]].u,g=i[r[0]].v,m=i[r[1]].v,p=i[r[2]].v;e.save(),e.beginPath(),e.moveTo(s,u),e.lineTo(o,h),e.lineTo(l,c),e.closePath(),e.clip();var k=d*m+g*v+f*p-m*v-g*f-d*p,y=s*m+g*l+o*p-m*l-g*o-s*p,b=d*o+s*v+f*l-o*v-s*f-d*l,C=d*m*l+g*o*v+s*f*p-s*m*v-g*f*l-d*o*p,w=u*m+g*c+h*p-m*c-g*h-u*p,x=d*h+u*v+f*c-h*v-u*f-d*c,S=d*m*c+g*h*v+u*f*p-u*m*v-g*f*c-d*h*p;e.transform(y/k,w/k,b/k,x/k,C/k,S/k),e.drawImage(t,0,0),e.restore()}}}]),a}();CanvasUtil.clearColor="rgba(0,0,0,0)",CanvasUtil.dataImgPrefix="data:image/png;base64,";var ColorRGB=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fromRGB",value:function(e,t,i){}},{key:"fromHex",value:function(e){}}]),e}(),ColorUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"hexToCanvasColor",value:function(e,t){return t=null!=t?t:"1.0",e=e.replace("#",""),"rgba("+parseInt(e.substring(0,2),16)+","+parseInt(e.substring(2,4),16)+","+parseInt(e.substring(4,6),16)+","+t+")"}},{key:"hexStringToNumberColor",value:function(e){return Number("0x"+e.replace("#",""))}},{key:"rgb2hex",value:function(e,t,i){return"#"+Number(16777216+65536*e+256*t+i).toString(16).substring(1)}},{key:"hex2rgb",value:function(e){return e=e.replace("#",""),{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}},{key:"rgb2hexNum",value:function(e,t,i){return Number("0x"+Number(16777216+65536*e+256*t+i).toString(16).substring(1))}},{key:"hexStr2HexNum",value:function(e){return parseInt(e.replace(/^#/,""),16)}},{key:"rgbToCanvasColor",value:function(e,t,i,n){return"rgba("+e+","+t+","+i+","+n+")"}},{key:"rgbToBrightness",value:function(e,t,i){return(e+t+i)/765}},{key:"rgb2hsv",value:function(e){var t,i,n,a,r,s;return t=e[0],i=e[1],n=e[2],min=Math.min(t,i,n),max=Math.max(t,i,n),s=max,delta=max-min,0==max?[a=-1,r=0,void 0]:(r=delta/max,a=t===max?(i-n)/delta:i===max?2+(n-t)/delta:4+(t-i)/delta,(a*=60)<0&&(a+=360),isNaN(a)&&(a=0),[a,r,s])}},{key:"hsv2rgb",value:function(e){var i,n,a,r,s,o,l;if(n=e[0],a=e[1],r=e[2],0===a)return[s=o=l=r,o,l];switch(n/=60,i=Math.floor(n),f=n-i,p=r*(1-a),q=r*(1-a*f),t=r*(1-a*(1-f)),i){case 0:s=r,o=t,l=p;break;case 1:s=q,o=r,l=p;break;case 2:s=p,o=r,l=t;break;case 3:s=p,o=q,l=r;break;case 4:s=t,o=p,l=r;break;default:s=r,o=p,l=q}return[s,o,l]}},{key:"saturateRGB",value:function(e,t){var i=CanvasUtil.rgb2hsv([e.r,e.g,e.b]);i[1]*=t,i[1]=Math.max(Math.min(0,i[1]),1);var n=hsv2rgb(i);return{r:n[0],g:n[1],b:n[2]}}},{key:"rgbDifference",value:function(e,t,i,n,a,r){return Math.abs(e+t+i-(n+a+r))/765}},{key:"colorLuminance",value:function(e,t){e=e.replace("#",""),(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var i,n,a="#";for(n=0;n<3;n++)i=parseInt(e.substr(2*n,2),16),a+=("00"+(i=Math.round(Math.min(Math.max(0,i+i*t),255)).toString(16))).substr(i.length);return a}}]),e}();console.todo=function(e){console.log("%c %s %s %s ","color: yellow; background-color: black;","--",e,"--")},console.important=function(e){console.log("%c%s %s %s","color: brown; font-weight: bold; text-decoration: underline;","--",e,"--")};var DataPrefix=function e(){_classCallCheck(this,e)};DataPrefix.png="data:image/png;base64,",DataPrefix.jpg="data:image/jpeg;base64,",DataPrefix.svg="data:image/svg+xml;base64,",DataPrefix.svgInline="data:image/svg+xml;utf8,",DataPrefix.mp3="data:audio/mpeg;base64,",DataPrefix.mp4="data:video/mp4;base64,",DataPrefix.webm="data:video/webm;base64,",DataPrefix.otf="data:font/opentype;base64,",DataPrefix.ttf="data:font/truetype;base64,",DataPrefix.css="data:text/css;base64,",DataPrefix.js="data:text/javascript;base64,",DataPrefix.html="data:text/html;charset=utf-8,";var DateUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getMillis",value:function(){return(new Date).getTime()}},{key:"getTodayTimeStamp",value:function(){var e=new Date;return e.getYear()+1900+"-"+(e.getMonth()+1)+"-"+e.getDate()}},{key:"datesAreEqual",value:function(e,t){return e.getTime()==t.getTime()}}]),e}();DateUtil.midnightTimeSuffix="T00:00:00Z";var DOMUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"closest",value:function(e,t){var i=1<(t=t.toLowerCase()).split(".").length?t.split(".")[1]:"";for(t=t.split(".")[0];;){if(e.nodeName.toLowerCase()===t&&-1!==e.className.indexOf(i))return e;if(!(e=e.parentNode))break}return null}},{key:"remove",value:function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}},{key:"stringToElement",value:function(e){return(new DOMParser).parseFromString(e,"text/html").body.firstElementChild}},{key:"stringToDomElement",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}},{key:"elementToString",value:function(e){return e.outerHTML}},{key:"addLoadedClass",value:function(){window.addEventListener("load",function(e){setTimeout(function(){document.body.classList.add("ready")},1e3)})}},{key:"isElementVisible",value:function(e){var t=e.getBoundingClientRect();return 0<t.bottom&&0<t.right&&t.left<(window.innerWidth||document.documentElement.clientWidth)&&t.top<(window.innerHeight||document.documentElement.clientHeight)}}]),e}(),EaseToValueCallback=function(){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:a.noop,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.01;if(_classCallCheck(this,a),void 0===EasingFloat)return console.warn("EaseToValueCallback requires EasingFloat");this.easingFloat=new EasingFloat(e,t),this.callback=i,this.finishRange=n}return _createClass(a,[{key:"setTarget",value:function(e){this.easingFloat.setTarget(e),this.easeToTarget()}},{key:"setValue",value:function(e){this.easingFloat.setValue(e)}},{key:"easeToTarget",value:function(){var e=this;this.callback(this.easingFloat.update()),Math.abs(this.easingFloat.value()-this.easingFloat.target())>this.finishRange?requestAnimationFrame(function(){e.easeToTarget()}):(this.easingFloat.setValue(this.easingFloat.target()),this.callback(this.easingFloat.value()))}}]),a}();EaseToValueCallback.noop=function(){};var EasingFloat=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.001;_classCallCheck(this,r),this.val=e,this.targetVal=e,this.easeFactor=t<=1?1/t:t,this.completeRange=i,this.speed=0,this.delay=0}return _createClass(r,[{key:"setTarget",value:function(e){return isNaN(parseFloat(e))||(this.targetVal=e),this}},{key:"setValue",value:function(e){return this.val=e,this}},{key:"setEaseFactor",value:function(e){return this.easeFactor=e<=1?1/e:e,this}},{key:"setDelay",value:function(e){return this.delay=e,this}},{key:"value",value:function(){return this.val}},{key:"target",value:function(){return this.targetVal}},{key:"isComplete",value:function(){return this.val==this.targetVal}},{key:"update",value:function(e){var t=0<arguments.length&&void 0!==e&&e;if(this.val!=this.targetVal){if(!(0<this.delay)){if(0==t)this.val+=(this.targetVal-this.val)/this.easeFactor;else{var i=(this.targetVal-this.val)/this.easeFactor;Math.abs(i)>Math.abs(this.speed)?(this.speed+=i/this.easeFactor,i=this.speed):this.speed=i,this.val+=i}return Math.abs(this.targetVal-this.val)<this.completeRange&&(this.val=this.targetVal),this.val}this.delay--}}},{key:"updateRadians",value:function(e){var t=0<arguments.length&&void 0!==e&&e;if(this.val!=this.targetVal){if(!(0<this.delay)){var i=this.targetVal-this.val,n=0;if(i>Math.PI?n=-r.TWO_PI:i<-Math.PI&&(n=r.TWO_PI),0==t)this.val+=(this.targetVal-this.val+n)/this.easeFactor;else{var a=(this.targetVal-this.val+n)/this.easeFactor;Math.abs(a)>Math.abs(this.speed)?(this.speed+=a/this.easeFactor,a=this.speed):this.speed=a,this.val+=a}return Math.abs(this.val-this.targetVal)<this.completeRange&&(this.val=this.targetVal),this.val}this.delay--}}}]),r}();EasingFloat.TWO_PI=2*Math.PI;var EasyScroll=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:window;_classCallCheck(this,t),this.scrollEl=e,this.startScrollY=0,this.scrollDist=0,this.frame=0,this.frames=0}return _createClass(t,[{key:"easeInOutQuad",value:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t}},{key:"animateScroll",value:function(){var e=this;this.frame++,this.frame<=this.frames&&requestAnimationFrame(function(){return e.animateScroll()});var t=this.frame/this.frames,i=this.scrollDist*this.easeInOutQuad(t,0,1,1);this.scrollEl==window?window.scrollTo(0,Math.round(this.startScrollY-i)):this.scrollEl.scrollTop=Math.round(this.startScrollY-i)}},{key:"scrollByY",value:function(e,t){var i=this;this.startScrollY=this.scrollEl==window?window.scrollY:this.scrollEl.scrollTop,this.scrollDist=t,this.frame=0,this.frames=Math.floor(e/16),requestAnimationFrame(function(){return i.animateScroll()})}},{key:"scrollToEl",value:function(e,t,i){var n=this.scrollEl==window?0:this.scrollEl.getBoundingClientRect().top;this.scrollByY(e,-t.getBoundingClientRect().top+i+n)}},{key:"setScrollEl",value:function(e){this.scrollEl=e}}]),t}(),ElasticFloat=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.8,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.2;_classCallCheck(this,n),this.val=e,this.fric=t,this.accel=i,this.targetVal=this.val,this.speed=0}return _createClass(n,[{key:"value",value:function(){return this.val}},{key:"target",value:function(){return this.targetVal}},{key:"setCurrent",value:function(e){this.val=e}},{key:"setTarget",value:function(e){this.targetVal=e}},{key:"setFriction",value:function(e){this.fric=e}},{key:"setAccel",value:function(e){this.accel=e}},{key:"update",value:function(){return this.speed=((this.targetVal-this.val)*this.accel+this.speed)*this.fric,this.val+=this.speed,this.val}}]),n}(),ErrorUtil=function(){function s(){_classCallCheck(this,s)}return _createClass(s,null,[{key:"initErrorCatching",value:function(){s.INITIALIZED||(window.addEventListener("error",function(e){var t=e.filename.split("/"),i=t[t.length-1],n=e.lineno,a=e.message,r=e.error.stack.replace("\n","<br>");s.showError("Message: <b>".concat(a,"</b><br>File: ").concat(i,"<br>Line: ").concat(n,"<br>Stack: ").concat(r,"<br>Error message: ").concat(JSON.stringify(e),"<br>"))}),s.INITIALIZED=!0)}},{key:"showError",value:function(e){var t=document.querySelector("#inline-error");t||((t=document.createElement("div")).setAttribute("id","inline-error"),t.setAttribute("style","box-sizing: border-box; position: fixed; top: 20px; left: 20px; width: calc(100% - 40px); max-height: calc(100% - 40px); background: rgba(0, 0, 0, 0.7); color: #fff; z-index: 99; font-size: 10px; padding: 20px 20px 0; overflow: auto;"),document.body.appendChild(t),t.addEventListener("click",function(e){document.body.removeChild(t)}));var i=document.createElement("p");i.setAttribute("style","border: 2px solid #ff0000; padding: 20px;"),i.innerHTML=e,t.appendChild(i),clearTimeout(s.TIMEOUT),s.TIMEOUT=setTimeout(function(){var e=document.querySelector("#inline-error");e&&e.parentNode.removeChild(e)},s.TIMEOUT_DURATION)}}]),s}();ErrorUtil.INITIALIZED=!1,ErrorUtil.TIMEOUT=null,ErrorUtil.TIMEOUT_DURATION=6e4;var FloatBuffer=function(){function t(e){_classCallCheck(this,t),this.size=e,this.initBuffer(),this.reset()}return _createClass(t,[{key:"initBuffer",value:function(){this.sampleIndex=0,this.buffer=[];for(var e=0;e<this.size;e++)this.buffer.push(0)}},{key:"reset",value:function(){for(var e=0;e<this.size;e++)this.buffer[e]=0}},{key:"update",value:function(e){this.sampleIndex++,this.sampleIndex==this.size&&(this.sampleIndex=0),this.buffer[this.sampleIndex]=e}},{key:"toString",value:function(){return this.buffer.reduce(function(e,t){return e+Math.round(10*t)/10+", "},"")}},{key:"average",value:function(){return this.sum()/this.size}},{key:"sum",value:function(){return this.buffer.reduce(function(e,t){return e+t},0)}},{key:"sumPositive",value:function(){return this.buffer.reduce(function(e,t){return 0<t?e+t:e},0)}},{key:"sumNegative",value:function(){return this.buffer.reduce(function(e,t){return t<0?e+t:e},0)}},{key:"sumAbs",value:function(){return this.buffer.reduce(function(e,t){return e+Math.abs(t)},0)}},{key:"max",value:function(){for(var e=this.buffer[0],t=1;t<this.size;t++)this.buffer[t]>e&&(e=this.buffer[t]);return e}},{key:"min",value:function(){for(var e=this.buffer[0],t=1;t<this.size;t++)this.buffer[t]<e&&(e=this.buffer[t]);return e}},{key:"maxAbs",value:function(){for(var e=Math.abs(this.buffer[0]),t=1;t<this.size;t++)Math.abs(this.buffer[t])>e&&(e=Math.abs(this.buffer[t]));return e}}]),t}(),FontUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"printFontInfoOnLoad",value:function(){document.fonts.onloadingdone=function(e){console.log("`document` loaded "+e.fontfaces.length+" font faces:"),e.fontfaces.forEach(function(e,t){console.log("- ",e.family)})}}}]),e}(),GATracking=function(){function l(){var e,t,i,n,a,r,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,l),null!=s&&(-1!=s.indexOf("UA-")&&console.warn("Please only use the numeric GA tracking id"),e=window,t=document,i="https://www.google-analytics.com/analytics"+(o?"_debug":"")+".js",n="ga",e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,a=t.createElement("script"),r=t.getElementsByTagName("script")[0],a.async=1,a.src=i,r.parentNode.insertBefore(a,r),o&&(window.ga_debug={trace:!0}),ga("create","UA-".concat(s),"auto"),ga("send","pageview"))}return _createClass(l,[{key:"event",value:function(e,t,i,n){var a=0<arguments.length&&void 0!==e?e:"test",r=1<arguments.length&&void 0!==t?t:"click",s=2<arguments.length&&void 0!==i?i:null,o=3<arguments.length&&void 0!==n?n:null;window.ga("send","event",a,r,s,o)}},{key:"page",value:function(e){var t=0<arguments.length&&void 0!==e?e:document.location.pathname;window.ga("set","page",t),window.ga("send","pageview")}}]),l}(),IframeUrlLoader=function(){function i(e,t){_classCallCheck(this,i),this.callback=t,this.iframeLoader=document.createElement("iframe"),this.iframeLoader.setAttribute("style","display:block; width: 1px; height: 1px; pointer-events: none; opacity: 0; position: absolute; top: -10px; left: -10px"),document.body.appendChild(this.iframeLoader),this.iframeLoader.src=e,this.checkForIframeReady()}return _createClass(i,[{key:"checkForIframeReady",value:function(){var e=this;this.iframeLoader.contentDocument.addEventListener("DOMContentLoaded",function(){return e.iframeLoaded()}),this.iframeLoader.contentWindow.addEventListener("load",function(){return e.iframeLoaded()}),this.iframeLoader.addEventListener("load",function(){return e.iframeLoaded()})}},{key:"iframeLoaded",value:function(){var e=this;this.callback(),this.iframeLoader&&setTimeout(function(){document.body.removeChild(e.iframeLoader),e.iframeLoader=null},2e3)}}],[{key:"recacheUrlForFB",value:function(e){return"https://graph.facebook.com/?scrape=true&id=".concat(window.encodeURIComponent(e))}}]),i}(),ImprovedNoise=function(){function t(){_classCallCheck(this,t),this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(var e=0;e<256;e++)this.p[256+e]=this.p[e]}return _createClass(t,[{key:"fade",value:function(e){return e*e*e*(e*(6*e-15)+10)}},{key:"lerp",value:function(e,t,i){return t+e*(i-t)}},{key:"grad",value:function(e,t,i,n){var a=15&e,r=a<8?t:i,s=a<4?i:12==a||14==a?t:n;return(0==(1&a)?r:-r)+(0==(2&a)?s:-s)}},{key:"noise",value:function(e,t,i){var n=~~e,a=~~t,r=~~i,s=255&n,o=255&a,l=255&r,u=(e-=n)-1,h=(t-=a)-1,c=(i-=r)-1,d=this.fade(e),f=this.fade(t),v=this.fade(i),g=this.p[s]+o,m=this.p[g]+l,p=this.p[g+1]+l,k=this.p[1+s]+o,y=this.p[k]+l,b=this.p[k+1]+l;return this.lerp(v,this.lerp(f,this.lerp(d,this.grad(this.p[m],e,t,i),this.grad(this.p[y],u,t,i)),this.lerp(d,this.grad(this.p[p],e,h,i),this.grad(this.p[b],u,h,i))),this.lerp(f,this.lerp(d,this.grad(this.p[m+1],e,t,c),this.grad(this.p[y+1],u,t,i-1)),this.lerp(d,this.grad(this.p[p+1],e,h,c),this.grad(this.p[b+1],u,h,c))))}}]),t}(),JsonPoller=function(){function n(e,t,i){_classCallCheck(this,n),this.url=e,this.callback=t,this.errorCallback=i,this.requestCount=0,this.fetchData()}return _createClass(n,[{key:"fetchData",value:function(){var t=this;this.requestCount++,fetch(this.url).then(function(e){return e.json()}).then(function(e){requestAnimationFrame(function(){t.callback(e),t.fetchData()})}).catch(function(e){t.errorCallback(e),t.fetchData()})}}]),n}(),KeyboardUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"addKeyListener",value:function(t,i){window.addEventListener("keydown",function(e){(e.keyCode?e.keyCode:e.which)==t&&i(e)})}}]),e}(),LazyImageLoader=function(){function n(e){_classCallCheck(this,n),this.el=e,this.scrollHandler=null;var t=this.el.querySelectorAll("[data-src]");this.imageEls=[];for(var i=0;i<t.length;i++)this.imageEls.push(t[i]);this.queuedEls=[],this.loading=!1,this.queueVisibleImages(),this.addScrollHandler()}return _createClass(n,[{key:"addScrollHandler",value:function(){this.scrollHandler=this.scrolled.bind(this),window.addEventListener("scroll",this.scrollHandler)}},{key:"removeScrollHandler",value:function(){null!=this.scrollHandler&&(window.removeEventListener("scroll",this.scrollHandler),this.scrollHandler=null)}},{key:"scrolled",value:function(){this.queueVisibleImages()}},{key:"queueVisibleImages",value:function(){for(var i=this,e=[],t=this.imageEls.length-1;0<=t;t--)if(DOMUtil.isElementVisible(this.imageEls[t])){var n=this.imageEls.splice(t,1)[0];e.push(n)}e.reverse(),e.forEach(function(e,t){i.queuedEls.push(e)}),0==this.loading&&this.loadNextImage(),0==this.imageEls.length&&0==this.queuedEls.length&&this.dispose()}},{key:"loadNextImage",value:function(){if(0<this.queuedEls.length){var e=this.queuedEls.shift();this.loadImage(e)}}},{key:"loadImage",value:function(e){var t=this;this.loading=!0;var i=new Image;i.onload=function(){t.loading=!1,t.cleanUpImg(e,i),t.loadNextImage()},i.onerror=function(){t.loading=!1,t.loadNextImage()},i.src=e.getAttribute("data-src")}},{key:"cleanUpImg",value:function(e,t){e.getAttribute("data-src-bg")?e.style.backgroundImage="url(".concat(t.src,")"):e.setAttribute("src",t.src),e.removeAttribute("data-src-bg"),e.removeAttribute("data-src")}},{key:"clearArray",value:function(e){e.splice(0,e.length)}},{key:"dispose",value:function(){this.removeScrollHandler(),this.clearArray(this.imageEls),this.clearArray(this.queuedEls)}}]),n}(),Lightbox=function(){function e(){var t=this;_classCallCheck(this,e),this.lightboxDiv=null,this.lightboxImgUrl=null,this.lightboxImageLoader=null,this.active=!1,document.addEventListener("click",function(e){return t.hideLightbox(e)}),document.addEventListener("keyup",function(e){return t.checkEscClose(e)}),window.addEventListener("scroll",function(e){return t.hideLightbox(e)}),document.addEventListener("click",function(e){return t.checkDocumentClick(e)})}return _createClass(e,[{key:"closest",value:function(e,t){for(t=t.toLowerCase();;){if(e.nodeName.toLowerCase()===t)return e;if(!(e=e.parentNode))break}return null}},{key:"checkDocumentClick",value:function(e){var t=this.closest(e.target,"a");t&&"lightbox"==t.getAttribute("rel")&&(e.preventDefault(),this.handleLightboxLink(t.href));var i=this.closest(e.target,"img");i&&i.classList.contains("imagexpander")&&(e.preventDefault(),this.handleLightboxLink(i.getAttribute("src")))}},{key:"handleLightboxLink",value:function(e){var t=this;this.lightboxImgUrl=e,this.lightboxImageLoader=new Image,this.lightboxImageLoader.addEventListener("load",function(e){return t.lightboxImageLoaded(e)}),this.lightboxImageLoader.src=this.lightboxImgUrl}},{key:"lightboxImageLoaded",value:function(){var e=this,t=this.lightboxImageLoader.height<window.innerHeight-40&&this.lightboxImageLoader.width<window.innerWidth-40?"lightbox-image-contained":"";this.lightboxDiv=document.createElement("div"),this.lightboxDiv.className="lightbox",this.lightboxDiv.innerHTML='<div class="lightbox-image-holder '+t+'" style="background-image:url('+this.lightboxImgUrl+')"></div>',document.body.appendChild(this.lightboxDiv),this.active=!0,requestAnimationFrame(function(){e.lightboxDiv.className="lightbox",requestAnimationFrame(function(){e.lightboxDiv.className="lightbox showing"})})}},{key:"checkEscClose",value:function(e){27==e.keyCode&&this.hideLightbox()}},{key:"hideLightbox",value:function(e){var t=this;this.active&&this.lightboxDiv&&(this.active=!1,this.lightboxDiv.className="lightbox",setTimeout(function(){document.body.removeChild(t.lightboxDiv)},300))}}]),e}(),LinearFloatTo=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.025;_classCallCheck(this,i),this.startVal=e,this.endVal=e,this.progress=new LinearFloat(0,t)}return _createClass(i,[{key:"update",value:function(){this.progress.update()}},{key:"value",value:function(){return this.map(this.progress.value(),0,1,this.startVal,this.endVal)}},{key:"valuePenner",value:function(e){return this.map(this.progress.valuePenner(e),0,1,this.startVal,this.endVal)}},{key:"setTarget",value:function(e){e!=this.endVal&&(this.startVal=this.value(),this.endVal=e,this.progress.setValue(0),this.progress.setTarget(1))}},{key:"map",value:function(e,t,i,n,a){return(e-t)/(i-t)*(a-n)+n}}]),i}(),LinearFloat=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.025;_classCallCheck(this,i),this.val=e,this.targetVal=e,this.inc=t,this.delay=0}return _createClass(i,[{key:"setValue",value:function(e){return this.val=e,this}},{key:"setTarget",value:function(e){return this.targetVal=e,this}},{key:"setInc",value:function(e){return this.inc=e,this}},{key:"setDelay",value:function(e){return this.delay=e,this}},{key:"value",value:function(){return this.val}},{key:"valuePenner",value:function(e){return e(this.val,0,1,1)}},{key:"valueMapped",value:function(e,t){return this.map(this.val,0,1,e,t)}},{key:"map",value:function(e,t,i,n,a){return(e-t)/(i-t)*(a-n)+n}},{key:"target",value:function(){return this.targetVal}},{key:"isComplete",value:function(){return this.val==this.targetVal}},{key:"update",value:function(){if(!(0<this.delay)){if(this.val!=this.targetVal){var e=!1;this.val<this.targetVal?(this.val+=this.inc,this.val>this.targetVal&&(e=!0)):(this.val-=this.inc,this.val<this.targetVal&&(e=!0)),1==e&&(this.val=this.targetVal)}return this.val}this.delay--}}]),i}(),MathUtil=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"scaleToTarget",value:function(e,t){return t/e}},{key:"speedToReachDestinationWithFriction",value:function(e,t){return e/(t*(1/(1-t)))}},{key:"randRange",value:function(e,t){return Math.round(Math.random()*(t-e))+e}},{key:"randRangeDecimel",value:function(e,t){return Math.random()*(t-e)+e}},{key:"randBoolean",value:function(){return.5<Math.random()}},{key:"randBooleanWeighted",value:function(e){return Math.random()<e}},{key:"getPercentWithinRange",value:function(e,t,i){return(i+=-e)/((t+=-e)-(e+=-e))}},{key:"lerp",value:function(e,t,i){return e+(t-e)*i}},{key:"map",value:function(e,t,i,n,a){return(e-t)/(i-t)*(a-n)+n}},{key:"roundToDecimal",value:function(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i}},{key:"easeTo",value:function(e,t,i){return e-(e-t)/i}},{key:"degreesToRadians",value:function(e){return e*(Math.PI/180)}},{key:"radiansToDegrees",value:function(e){return e*(180/Math.PI)}},{key:"percentToDegrees",value:function(e){return 360*Math.abs(e)}},{key:"degreesToPercent",value:function(e){return Math.abs(e/360)}},{key:"saw",value:function(e){return Math.abs(e%(2*Math.PI)-Math.PI)/Math.PI*2-1}},{key:"sums",value:function(e){for(var t=0,i=e.length,n=0;n<i;n++)t+=e[n];return t}},{key:"average",value:function(e){return r.sums(e)/e.length}},{key:"interp",value:function(e,t,i){return(t-e)*i+e}},{key:"remap",value:function(e,t,i,n,a){return r.interp(n,a,r.getPercentWithinRange(t,i,e))}},{key:"getDistance",value:function(e,t,i,n){var a=e-i,r=t-n;return Math.abs(Math.sqrt(a*a+r*r))}},{key:"smoothstep",value:function(e,t,i){return(i=clamp((i-e)/(t-e),0,1))*i*(3-2*i)}},{key:"clamp",value:function(e,t,i){return Math.max(t,Math.min(i,e))}},{key:"constrainAngle",value:function(e){return e<0?e+360:360<e?e-360:e}},{key:"constrainRadians",value:function(e){return e<0?e+2*Math.PI:e>2*Math.PI?e-2*Math.PI:e}},{key:"getAngleToTarget",value:function(e,t,i,n){return r.constrainAngle(180*-Math.atan2(e-i,t-n)/Math.PI)}},{key:"getRadiansToTarget",value:function(e,t,i,n){return(r.TWO_PI+-Math.PI/2+Math.atan2(i-e,n-t))%r.TWO_PI}},{key:"getRadiansToTarget2",value:function(e,t,i,n){return-Math.atan2(n-t,i-e)%r.TWO_PI}},{key:"getRotationDirectionToTarget",value:function(e,t){var i=Math.abs(e-t);return t<e?i<180?-1:1:i<180?1:-1}},{key:"circleRadiusToEnclosingSquareCorner",value:function(e){return e/2*(Math.sqrt(2)-1)}},{key:"rectsIntersect",value:function(e,t){return e.left<=t.right&&t.left<=e.right&&e.top<=t.bottom&&t.top<=e.bottom}}]),r}();MathUtil.TWO_PI=2*Math.PI;var MicrophoneNode=function(){function a(e,t,i){var n=this;_classCallCheck(this,a),this.context=e||new AudioContext,navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){n.micNode=n.context.createMediaStreamSource(e),window.micNode=n.micNode,t(n.micNode)}).catch(function(e){i?i(e):console.log("The following getUserMedia error occured: "+e)})}return _createClass(a,[{key:"getNode",value:function(){return this.micNode}},{key:"getContext",value:function(){return this.context}}]),a}(),MobileUtil=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"isFullscreenApp",value:function(){return window.navigator.standalone}},{key:"enablePseudoStyles",value:function(){document.addEventListener("touchstart",function(){},!1)}},{key:"setDeviceInputClass",value:function(){var e=n.isMobileBrowser()?"mobile":"desktop";document.body.classList.add(e)}},{key:"lockTouchScreen",value:function(e){document.ontouchmove=0==e?null:function(e){e.preventDefault()}}},{key:"disableZoom",value:function(){document.addEventListener("touchmove",function(e){1!=(e=e.originalEvent||e).scale&&e.preventDefault()},!1)}},{key:"disableTrackpadZoom",value:function(){window.addEventListener("mousewheel",function(e){e.ctrlKey&&e.preventDefault()})}},{key:"hideSoftKeyboard",value:function(){document.activeElement&&document.activeElement.blur&&document.activeElement.blur();for(var e=document.querySelectorAll("input"),t=0;t<e.length;t++)e[t].blur()}},{key:"unlockWebAudioOnTouch",value:function(){window.addEventListener("touchstart",n.playEmptyWebAudioSound)}},{key:"playEmptyWebAudioSound",value:function(){var e=null!=AudioContext?new AudioContext:new webkitAudioContext,t=e.createBuffer(1,1,44100),i=e.createBufferSource();i.buffer=t,i.connect(e.destination),i.start(),window.removeEventListener("touchstart",n.playEmptyWebAudioSound)}},{key:"isMobileBrowser",value:function(){return!!navigator.userAgent.toLowerCase().match(/android|iphone|ipad|ipod/i)}},{key:"isIOS",value:function(){var e=navigator.userAgent.toLowerCase();return!!e.match(/iphone/i)||(!!e.match(/ipad/i)||(!!e.match(/ipod/i)||!!e.match(/crios/i)))}},{key:"isIPhone",value:function(){var e=navigator.userAgent.toLowerCase();return!!e.match(/iphone/i)||!!e.match(/ipod/i)}},{key:"isAndroid",value:function(){return!!navigator.userAgent.toLowerCase().match(/android/i)}},{key:"isSafari",value:function(){var e=navigator.userAgent.toLowerCase(),t=!!e.match(/chrome/i),i=!!e.match(/safari/i);return 1==i&&0==t}},{key:"isIE11",value:function(){return!!window.MSInputMethodContext&&!!document.documentMode}},{key:"alertErrors",value:function(){window.addEventListener&&window.addEventListener("error",function(e){var t=e.filename.split("/"),i=t[t.length-1],n=e.lineno,a=e.message;alert("ERROR\nLine "+n+" in "+i+"\n"+a)})}},{key:"openNewWindow",value:function(e){var t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("target","_blank");var i=document.createEvent("Event");return i.initEvent("click",!0,!1),t.dispatchEvent(i),!1}}]),n}(),ObjectPool=function(){function t(e){_classCallCheck(this,t),this.klass=e,this.objects=[]}return _createClass(t,[{key:"pool",value:function(){return this.objects}},{key:"getObject",value:function(){var e=this.objects.find(function(e){return 0==e.active});return e||(this.objects.push(new this.klass),this.objects[this.objects.length-1])}},{key:"anyActive",value:function(){return null!=this.objects.find(function(e){return 1==e.active})}}]),t}(),Oscillations=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"osc1",value:function(e){return Math.pow(Math.sin(e),3)}},{key:"osc2",value:function(e){return Math.pow(Math.sin(e*Math.PI),12)}},{key:"osc3",value:function(e){return Math.sin(Math.tan(1.2*Math.cos(e)))}}]),e}();if(window.p5){var P=function e(){_classCallCheck(this,e)};P.p=null,window.P=P,window.p=null;var P5Sketch=function(){function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body;return _classCallCheck(this,i),e=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,function(e){})),P.p=window.p=_assertThisInitialized(e),e.setup=e.setup.bind(_assertThisInitialized(e)),e.draw=e.draw.bind(_assertThisInitialized(e)),e.windowResized=e.windowResized.bind(_assertThisInitialized(e)),e.el=t,e.elSize=e.el.getBoundingClientRect(),e}return _inherits(i,p5),_createClass(i,[{key:"setup",value:function(){this.createCanvas(this.elSize.width,this.elSize.height,p5.prototype.WEBGL),this.el.appendChild(this.canvas),this.background(0),this.setupFirstFrame()}},{key:"setupFirstFrame",value:function(){}},{key:"draw",value:function(){this.background(127+127*Math.sin(.01*this.frameCount))}},{key:"windowResized",value:function(){this.elSize=this.el.getBoundingClientRect(),this.resizeCanvas(this.elSize.width,this.elSize.height)}},{key:"width",value:function(){return this.elSize.width}},{key:"height",value:function(){return this.elSize.height}}]),i}();P5Sketch.defaultVertShader="\n  // vertex shader\n  attribute vec3 aPosition;\n  attribute vec2 aTexCoord;\n  varying vec2 vTexCoord;\n  void main() {\n    vTexCoord = aTexCoord;\n    vec4 positionVec4 = vec4(aPosition, 1.0);\n    positionVec4.xy = positionVec4.xy * 2.0 - 1.0;\n    // positionVec4.xy = positionVec4.xy - 0.5;\n    gl_Position = positionVec4;\n  }\n  ",window.P5Sketch=P5Sketch}var PageVisibility=function(){function i(e,t){_classCallCheck(this,i),this.activeCallback=e||null,this.inactiveCallback=t||null,this.getPrefix(),this.initPageVisibilityApi()}return _createClass(i,[{key:"getPrefix",value:function(){if(this.prefix=null,void 0!==document.hidden)this.prefix="";else for(var e=["webkit","moz","ms","o"],t=0;t<e.length;t++)if(null!=document[e[t]+"Hidden"]){this.prefix=e[t];break}}},{key:"updateState",value:function(e){!1===document.hidden||!1===document[this.prefix+"Hidden"]?null!=this.activeCallback&&this.activeCallback():null!=this.inactiveCallback&&this.inactiveCallback()}},{key:"initPageVisibilityApi",value:function(){var t=this;null===this.prefix?console.log("Your browser does not support Page Visibility API"):document.addEventListener(this.prefix+"visibilitychange",function(e){return t.updateState(e)})}}]),i}(),Penner=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"easeInQuad",value:function(e,t,i,n){return i*(e/=n)*e+t}},{key:"easeOutQuad",value:function(e,t,i,n){return-i*(e/=n)*(e-2)+t}},{key:"easeInOutQuad",value:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t}},{key:"easeInCubic",value:function(e,t,i,n){return i*(e/=n)*e*e+t}},{key:"easeOutCubic",value:function(e,t,i,n){return i*((e=e/n-1)*e*e+1)+t}},{key:"easeInOutCubic",value:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t}},{key:"easeInQuart",value:function(e,t,i,n){return i*(e/=n)*e*e*e+t}},{key:"easeOutQuart",value:function(e,t,i,n){return-i*((e=e/n-1)*e*e*e-1)+t}},{key:"easeInOutQuart",value:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t}},{key:"easeInQuint",value:function(e,t,i,n){return i*(e/=n)*e*e*e*e+t}},{key:"easeOutQuint",value:function(e,t,i,n){return i*((e=e/n-1)*e*e*e*e+1)+t}},{key:"easeInOutQuint",value:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e*e+t:i/2*((e-=2)*e*e*e*e+2)+t}},{key:"easeInSine",value:function(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t}},{key:"easeOutSine",value:function(e,t,i,n){return i*Math.sin(e/n*(Math.PI/2))+t}},{key:"easeInOutSine",value:function(e,t,i,n){return-i/2*(Math.cos(Math.PI*e/n)-1)+t}},{key:"easeInExpo",value:function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t}},{key:"easeOutExpo",value:function(e,t,i,n){return e==n?t+i:i*(1-Math.pow(2,-10*e/n))+t}},{key:"easeInOutExpo",value:function(e,t,i,n){return 0==e?t:e==n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(2-Math.pow(2,-10*--e))+t}},{key:"easeInCirc",value:function(e,t,i,n){return-i*(Math.sqrt(1-(e/=n)*e)-1)+t}},{key:"easeOutCirc",value:function(e,t,i,n){return i*Math.sqrt(1-(e=e/n-1)*e)+t}},{key:"easeInOutCirc",value:function(e,t,i,n){return(e/=n/2)<1?-i/2*(Math.sqrt(1-e*e)-1)+t:i/2*(Math.sqrt(1-(e-=2)*e)+1)+t}},{key:"easeInElastic",value:function(e,t,i,n){var a=1.70158,r=0,s=i;if(0==e)return t;if(1==(e/=n))return t+i;if(r=r||.3*n,s<Math.abs(i)){s=i;a=r/4}else a=r/(2*Math.PI)*Math.asin(i/s);return-s*Math.pow(2,10*(e-=1))*Math.sin((e*n-a)*(2*Math.PI)/r)+t}},{key:"easeOutElastic",value:function(e,t,i,n){var a=1.70158,r=0,s=i;if(0==e)return t;if(1==(e/=n))return t+i;if(r=r||.3*n,s<Math.abs(i)){s=i;a=r/4}else a=r/(2*Math.PI)*Math.asin(i/s);return s*Math.pow(2,-10*e)*Math.sin((e*n-a)*(2*Math.PI)/r)+i+t}},{key:"easeInOutElastic",value:function(e,t,i,n){var a=1.70158,r=0,s=i;if(0==e)return t;if(2==(e/=n/2))return t+i;if(r=r||n*(.3*1.5),s<Math.abs(i)){s=i;a=r/4}else a=r/(2*Math.PI)*Math.asin(i/s);return e<1?s*Math.pow(2,10*(e-=1))*Math.sin((e*n-a)*(2*Math.PI)/r)*-.5+t:s*Math.pow(2,-10*(e-=1))*Math.sin((e*n-a)*(2*Math.PI)/r)*.5+i+t}},{key:"easeInBack",value:function(e,t,i,n,a){return null==a&&(a=1.70158),i*(e/=n)*e*((a+1)*e-a)+t}},{key:"easeOutBack",value:function(e,t,i,n,a){return null==a&&(a=1.70158),i*((e=e/n-1)*e*((a+1)*e+a)+1)+t}},{key:"easeInOutBack",value:function(e,t,i,n,a){return null==a&&(a=1.70158),(e/=n/2)<1?i/2*(e*e*((1+(a*=1.525))*e-a))+t:i/2*((e-=2)*e*((1+(a*=1.525))*e+a)+2)+t}},{key:"easeOutBounce",value:function(e,t,i,n){return(e/=n)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t}}]),e}(),PixiSpriteScale=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"scaleToFillContainer",value:function(e,t,i){var n=t/e.texture.width,a=i/e.texture.height,r=a<n?n:a;return e.scale.set(r,r),r}},{key:"scaleToFillContainerMult",value:function(e,t,i,n){var a=t/e.texture.width,r=i/e.texture.height,s=r<a?a:r;return s*=n,e.scale.set(s,s),s}},{key:"scaleToLetterboxContainer",value:function(e,t,i){var n=t/e.texture.width,a=i/e.texture.height,r=n<a?n:a;return e.scale.set(r,r),r}},{key:"scaleToHeight",value:function(e,t){var i=t/e.texture.height;return e.scale.set(i,i),i}},{key:"scaleToWidth",value:function(e,t){var i=t/e.texture.width;return e.scale.set(i,i),i}}]),e}(),PixiStageV4=function(){function n(e,t,i){_classCallCheck(this,n),this.el=e,this.elSize=this.el.getBoundingClientRect(),this.devicePixelRatio=window.devicePixelRatio,PIXI.settings.PRECISION_FRAGMENT="highp",this.renderer=PIXI.autoDetectRenderer(this.elSize.width,this.elSize.height,{backgroundColor:t,transparent:!1,resolution:this.devicePixelRatio}),this.renderer.view.classList.add(i),this.el.appendChild(this.renderer.view),this.stage=new PIXI.Container,this.stage.interactive=!0,this.resize()}return _createClass(n,[{key:"container",value:function(){return this.stage}},{key:"width",value:function(){return this.renderer.width/this.devicePixelRatio}},{key:"height",value:function(){return this.renderer.height/this.devicePixelRatio}},{key:"render",value:function(){this.renderer.render(this.stage)}},{key:"resize",value:function(){this.elSize=this.el.getBoundingClientRect(),this.renderer.resize(this.elSize.width,this.elSize.height)}}]),n}(),PixiStage=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,i),this.el=e,this.elSize=this.el.getBoundingClientRect(),this.devicePixelRatio=window.devicePixelRatio||1,this.app=new PIXI.Application({width:this.elSize.width,height:this.elSize.height,backgroundColor:t,transparent:!1,resizeTo:this.el,autoDensity:!0,antialias:!0,resolution:this.devicePixelRatio}),e.appendChild(this.app.view),this.rootContainer=new PIXI.Container,this.app.stage.addChild(this.rootContainer)}return _createClass(i,[{key:"addFrameListener",value:function(e){this.app.ticker.add(e)}},{key:"removeFrameListener",value:function(e){this.app.ticker.remove(e)}},{key:"stage",value:function(){return this.app.stage}},{key:"canvas",value:function(){return this.app.view}},{key:"container",value:function(){return this.rootContainer}},{key:"width",value:function(){return this.app.renderer.width/this.devicePixelRatio}},{key:"widthRenderer",value:function(){return this.app.renderer.width}},{key:"height",value:function(){return this.app.renderer.height/this.devicePixelRatio}},{key:"heightRenderer",value:function(){return this.app.renderer.height}},{key:"fps",value:function(){return this.app.ticker.FPS}}]),i}(),PixiTextureLoader=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,i),this.assetsLoadedCallback=e,this.keepFinalCallback=t,this.numTextures=0,this.numLoaded=0}return _createClass(i,[{key:"loadTexture",value:function(e,t){var i=this,n=PIXI.Texture.fromImage(e);2<=n.width?(n.baseTexture.scaleMode=PIXI.settings.SCALE_MODE,t(new PIXI.Sprite(n))):(this.numTextures++,n.baseTexture.on("loaded",function(){n.baseTexture.scaleMode=PIXI.settings.SCALE_MODE,t(new PIXI.Sprite(n)),i.numLoaded++,i.numLoaded==i.numTextures&&(i.assetsLoadedCallback&&i.assetsLoadedCallback(),0==i.keepFinalCallback&&(i.assetsLoadedCallback=null))}))}},{key:"loadTextures",value:function(n,a){for(var r=this,s=0,o=new Array(n.length),e=function(e){var t,i;i=n[t=e],r.loadTexture(i,function(e){o[t]=e,++s>=n.length&&a(o)})},t=0;t<n.length;t++)e(t)}}],[{key:"svgElToPixiTexture",value:function(e,t){var i=SVGUtil.svgElToBase64(e),n=PIXI.Texture.fromImage(i);n.baseTexture.on("loaded",function(){t(new PIXI.Sprite(n))})}}]),i}(),PointerPos=function(){function e(){var t=this;_classCallCheck(this,e),this.curX=-1,this.curY=-1,this.lastX=-1,this.lastY=-1,document.addEventListener("mousedown",function(e){t.pointerMoved(e.clientX,e.clientY)}),document.addEventListener("mousemove",function(e){t.pointerMoved(e.clientX,e.clientY)}),document.addEventListener("touchstart",function(e){t.pointerMoved(e.touches[0].clientX,e.touches[0].clientY)}),document.addEventListener("touchmove",function(e){t.pointerMoved(e.touches[0].clientX,e.touches[0].clientY)})}return _createClass(e,[{key:"reset",value:function(){this.curX=-1,this.curY=-1,this.lastX=-1,this.lastY=-1}},{key:"pointerMoved",value:function(e,t){this.lastX=this.curX,this.lastY=this.curY,this.curX=e,this.curY=t}},{key:"x",value:function(e){var t=0<arguments.length&&void 0!==e?e:null;if(t){var i=t.getBoundingClientRect();return this.curX-i.left}return this.curX}},{key:"y",value:function(e){var t=0<arguments.length&&void 0!==e?e:null;if(t){var i=t.getBoundingClientRect();return this.curY-i.top}return this.curY}},{key:"xPercent",value:function(e){if(null==e)return this.curX/window.innerWidth;var t=e.getBoundingClientRect();return(this.curX-t.left)/t.width}},{key:"yPercent",value:function(e){if(null==e)return this.curY/window.innerHeight;var t=e.getBoundingClientRect();return(this.curY-t.top)/t.height}},{key:"xDelta",value:function(){return-1==this.lastX?0:this.curX-this.lastX}},{key:"yDelta",value:function(){return-1==this.lastY?0:this.curY-this.lastY}}]),e}(),PointerUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"multipleClickHandler",value:function(){var t=[];cameraInput.addEventListener(window.tapEvent,function(e){for(t.push(Date.now());5<t.length;)t.shift();t.filter(function(e){return e>Date.now()-3e3}).length<5?e.preventDefault():t.splice(0)})}},{key:"disableRightClick",value:function(e){e.oncontextmenu=function(e){return!1}}}]),e}(),ShareOut=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"closest",value:function(e,t){for(t=t.toLowerCase();;){if(e.nodeName.toLowerCase()===t)return e;if(!(e=e.parentNode))break}return null}},{key:"clickedShareContainer",value:function(e){e.preventDefault();var t=this.closest(e.target,"a")||this.closest(e.target,"button");t&&this.sharePostToService(t.getAttribute("data-network"),t.getAttribute("href"))}},{key:"sharePostToService",value:function(e,t){var i,n;return"email"===e?this.sharePostToEmail(t):(n=a.networkShareDimensions[e].width||700,i=a.networkShareDimensions[e].height||450,window.open(t,"_blank","width="+n+", height="+i+", left="+(window.innerWidth/2-n/2)+", top="+(window.innerHeight/2-i/2)+", toolbar=0, location=0, menubar=0, directories=0, scrollbars=0"))}},{key:"sharePostToEmail",value:function(e){document.location.href=e}},{key:"setShareLinks",value:function(e,t,i,n){var a,r,s,o,l,u,h,c;if("%0D%0A",l=window.encodeURIComponent(i.trim()),c=t&&0<t.length?window.encodeURIComponent(t):"",r=i,s=window.encodeURIComponent(r),a=l+"%0D%0A%0D%0A"+c,139<(u=i).length+c.length&&((o=(u=u.substr(0,115)).split(" ")).pop(),u=o.join(" ")),h=window.encodeURIComponent(u),e.querySelector('[data-network="email"]')&&e.querySelector('[data-network="email"]').setAttribute("href","mailto:?subject="+s+"&body="+a),e.querySelector('[data-network="facebook"]')){var d=e.querySelector('[data-network="facebook"]');null!=d.getAttribute("data-facebook-quote")?d.setAttribute("href","https://www.facebook.com/sharer/sharer.php?quote="+l+"&u="+c):d.setAttribute("href","https://www.facebook.com/sharer/sharer.php?u="+c)}e.querySelector('[data-network="twitter"]')&&e.querySelector('[data-network="twitter"]').setAttribute("href","https://twitter.com/intent/tweet?url="+c+"&text="+h),e.querySelector('[data-network="pinterest"]')&&e.querySelector('[data-network="pinterest"]').setAttribute("href","http://pinterest.com/pin/create/button/?url="+c+"&description="+l+"&media="+n),e.querySelector('[data-network="googleplus"]')&&e.querySelector('[data-network="googleplus"]').setAttribute("href","https://plus.google.com/share?url="+c),e.querySelector('[data-network="tumblr"]')&&e.querySelector('[data-network="tumblr"]').setAttribute("href","http://www.tumblr.com/share/link?posttype=link&url="+c+"&title="+l+"&content="+l+"&caption="+l),e.querySelector('[data-network="linkedin"]')&&e.querySelector('[data-network="linkedin"]').setAttribute("href","http://www.linkedin.com/shareArticle?mini=true&url="+c+"&title="+l),e.querySelector('[data-network="yammer"]')&&e.querySelector('[data-network="yammer"]').setAttribute("href","https://www.yammer.com/messages/new?login=true&status="+l+": "+c),this.clickHandler=this.clickedShareContainer.bind(this),e.addEventListener("click",this.clickHandler)}},{key:"disposeShareLinks",value:function(e){e.removeEventListener("click",this.clickHandler),this.clickHandler=null}}]),a}();ShareOut.networkShareDimensions={facebook:{width:480,height:210},twitter:{width:550,height:420},pinterest:{width:750,height:320},googleplus:{width:500,height:385},tumblr:{width:450,height:430},reddit:{width:540,height:420},linkedin:{width:550,height:460},yammer:{width:600,height:350}};var SolidSocket=function(){function n(e){_classCallCheck(this,n),document.body.classList.add("no-socket"),this.wsAddress=e,this.socket=new WebSocket(e),this.addSocketListeners(),this.lastConnectAttemptTime=Date.now(),this.startMonitoringConnection()}return _createClass(n,[{key:"addSocketListeners",value:function(){this.openHandler=this.onOpen.bind(this),this.socket.addEventListener("open",this.openHandler),this.messageHandler=this.onMessage.bind(this),this.socket.addEventListener("message",this.messageHandler),this.errorHandler=this.onError.bind(this),this.socket.addEventListener("error",this.errorHandler),this.closeHandler=this.onClose.bind(this),this.socket.addEventListener("close",this.closeHandler)}},{key:"removeSocketListeners",value:function(){this.socket.removeEventListener("open",this.openHandler),this.socket.removeEventListener("message",this.messageHandler),this.socket.removeEventListener("error",this.errorHandler),this.socket.removeEventListener("close",this.closeHandler),this.socket.close()}},{key:"onOpen",value:function(e){document.body.classList.add("has-socket"),document.body.classList.remove("no-socket"),this.openCallback&&this.openCallback(e)}},{key:"setOpenCallback",value:function(e){this.openCallback=e}},{key:"onMessage",value:function(e){this.messageCallback&&this.messageCallback(e)}},{key:"setMessageCallback",value:function(e){this.messageCallback=e}},{key:"onError",value:function(e){this.errorCallback&&this.errorCallback(e)}},{key:"setErrorCallback",value:function(e){this.errorCallback=e}},{key:"onClose",value:function(e){this.closeCallback&&this.closeCallback(e)}},{key:"setCloseCallback",value:function(e){this.closeCallback=e}},{key:"sendMessage",value:function(e){this.socket.send(e)}},{key:"startMonitoringConnection",value:function(){this.checkConnection()}},{key:"checkConnection",value:function(){var e=this,t=this.socket.readyState==WebSocket.OPEN,i=this.socket.readyState==WebSocket.CONNECTING;if(Date.now()>this.lastConnectAttemptTime+n.RECONNECT_INTERVAL){if(this.lastConnectAttemptTime=Date.now(),!t&&!i){this.removeSocketListeners();try{this.socket=new WebSocket(this.wsAddress),this.addSocketListeners()}catch(e){console.log("Websocket couldn't connect: ",e)}}t?(document.body.classList.add("has-socket"),document.body.classList.remove("no-socket")):(document.body.classList.add("no-socket"),document.body.classList.remove("has-socket"))}requestAnimationFrame(function(){return e.checkConnection()})}}]),n}();SolidSocket.RECONNECT_INTERVAL=2e3;var SoundFFT=function(){function n(e,t){_classCallCheck(this,n),this.context=e,this.audioNode=t,this.debug=!1,this.analyser=this.context.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioNode.connect(this.analyser),this.binCount=this.analyser.frequencyBinCount,this.spectrumData=new Uint8Array(this.binCount),this.spectrum=new Array(this.binCount),this.spectrumCrossfaded=new Array(this.binCount);for(var i=0;i<this.binCount;i++)this.spectrum[i]=0;this.waveformData=new Uint8Array(this.binCount),this.waveform=new Array(this.binCount);for(i=0;i<this.binCount;i++)this.waveform[i]=0;this.freqDecay=.98,this.detectedBeat=!1,this.beatCutOff=0,this.beatLastTime=0,this.beatHoldTime=300,this.beatDecayRate=.97,this.beatMin=.15,this.avgAmp=0,this.ampDir=new FloatBuffer(5)}return _createClass(n,[{key:"setDebug",value:function(e){this.debug=e}},{key:"getSpectrum",value:function(){return this.spectrum}},{key:"getWaveform",value:function(){return this.waveform}},{key:"getDetectedBeat",value:function(){return this.detectedBeat}},{key:"update",value:function(){this.analyser&&(this.analyser.getByteFrequencyData(this.spectrumData),this.analyser.getByteTimeDomainData(this.waveformData),this.normalizeSpectrumFloats(!1),this.normalizeWaveformFloats(),this.calcAverageLevel(),this.detectBeats(),ArrayUtil.crossfadeEnds(this.waveform,.05),this.debug&&this.drawDebug())}},{key:"normalizeSpectrumFloats",value:function(e){if(0==e)for(var t=0;t<this.spectrumData.length;t++){var i=this.spectrumData[t]/255;this.spectrum[t]=Math.max(i,this.spectrum[t]*this.freqDecay)}else{for(t=0;t<this.spectrumData.length;t++){var n=this.spectrumData[t]/255;this.spectrumCrossfaded[t]=n}ArrayUtil.crossfadeEnds(this.spectrumCrossfaded,.5);for(t=0;t<this.spectrumCrossfaded.length;t++){var a=this.spectrumCrossfaded[t];this.spectrum[t]=Math.max(a,this.spectrum[t]*this.freqDecay)}}}},{key:"normalizeWaveformFloats",value:function(){for(var e=0;e<this.waveformData.length;e++)this.waveform[e]=2*(this.waveformData[e]/255-.5)}},{key:"calcAverageLevel",value:function(){for(var e=this.avgAmp,t=0,i=0;i<this.spectrum.length;i++)t+=this.spectrum[i];this.avgAmp=t/this.spectrum.length,this.ampDir.update(this.avgAmp-e)}},{key:"detectBeats",value:function(){this.avgAmp>this.beatCutOff&&this.avgAmp>this.beatMin&&this.beatDetectAvailable()&&.01<this.ampDir.average()?(this.detectedBeat=!0,this.beatCutOff=1.1*this.avgAmp,this.beatLastTime=Date.now()):(this.detectedBeat=!1,this.beatDetectAvailable()&&(this.beatCutOff*=this.beatDecayRate,this.beatCutOff=Math.max(this.beatCutOff,this.beatMin)))}},{key:"beatDetectAvailable",value:function(){return Date.now()>this.beatLastTime+this.beatHoldTime}},{key:"resetSpectrum",value:function(){if(this.spectrum)for(var e=0;e<this.spectrum.length;e++)0<this.spectrum[e]&&(this.spectrum[e]=this.spectrum[e]-1)}},{key:"buildDebugCanvas",value:function(){this.debugW=200,this.debugH=140,this.fftH=2*this.debugH/5,this.debugWhite="#fff",this.debugGreen="rgba(0, 255, 0, 1)",this.debugBlack="#000",this.clearColor="rgba(0, 0, 0, 0)",this.canvas=document.createElement("canvas"),this.canvas.width=this.debugW,this.canvas.height=this.debugH,this.canvas.setAttribute("style","position:absolute;bottom:0;right:0;z-index:9999"),document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle=this.debugBlack,this.ctx.strokeStyle=this.debugWhite,this.ctx.lineWidth=2}},{key:"getDebugCanvas",value:function(){return this.canvas}},{key:"drawDebug",value:function(){null==this.ctx&&this.buildDebugCanvas(),this.ctx.fillStyle=this.debugBlack,this.ctx.strokeStyle=this.debugWhite,this.ctx.fillRect(0,0,this.debugW,this.debugH),this.ctx.strokeRect(0,0,this.debugW,this.fftH),this.ctx.strokeRect(0,this.fftH,this.debugW,this.fftH),this.ctx.strokeRect(0,2*this.fftH,this.debugW,this.fftH/2);var e=this.debugW/this.binCount;this.ctx.fillStyle=this.debugWhite,this.ctx.lineWidth=e;for(var t=0;t<this.binCount;t++)this.ctx.fillRect(t*e,this.fftH,e,-this.spectrum[t]*this.fftH);this.ctx.strokeStyle=this.debugWhite,this.ctx.beginPath();for(t=0;t<this.binCount;t++)this.ctx.lineTo(t*e,1.5*this.fftH+this.waveform[t]*this.fftH/2);this.ctx.stroke(),this.ctx.fillStyle=this.debugWhite,0==this.beatDetectAvailable()&&Date.now()<this.beatLastTime+200&&(this.ctx.fillStyle=this.debugGreen),this.ctx.fillRect(0,2*this.fftH,this.debugW*this.avgAmp,this.fftH/2),this.ctx.fillRect(this.debugW*this.beatCutOff,2*this.fftH,2,this.fftH/2)}}]),n}();SoundFFT.FREQUENCIES="SoundFFT.FREQUENCIES",SoundFFT.WAVEFORM="SoundFFT.WAVEFORM",SoundFFT.BEAT="SoundFFT.BEAT";var Sounds=function(){function i(){_classCallCheck(this,i),_store.addListener(this),this.sounds={},this.loadSounds(),this.initMute()}return _createClass(i,[{key:"loadSounds",value:function(){for(var e in i.audioFiles){var t=i.audioFiles[e];this.sounds[t]=new Howl({src:[t]})}}},{key:"initMute",value:function(){this.muted=!1,"true"==window.localStorage.getItem("audio-mute")&&this.toggleMute()}},{key:"toggleMute",value:function(e){this.muted=!this.muted,Howler.mute(this.muted),0==this.muted?(window.localStorage.setItem("audio-mute","false"),document.body.classList.remove("audio-muted")):(window.localStorage.setItem("audio-mute","true"),document.body.classList.add("audio-muted"))}},{key:"getSound",value:function(e){return this.sounds[e]}},{key:"playSound",value:function(e){this.sounds[e].stop().play()}},{key:"storeUpdated",value:function(e,t){e==i.PLAY_SOUND&&this.playSound(t)}},{key:"playSoundtrack",value:function(){this.menuSoundtrackAdded||(this.menuSoundtrackAdded=!0,MobileUtil.isMobileBrowser()?document.body.addEventListener("touchstart",this.startIntroLoop()):this.startIntroLoop())}},{key:"startIntroLoop",value:function(){if(!this.introLoopStarted){this.introLoopStarted=!0;var e=i.audioFiles.MENU_LOOP;this.sounds[e]=new Howl({src:[e],volume:0,loop:!0}),this.playSound(e),this.getSound(e).fade(0,.75,750)}}}]),i}();Sounds.PLAY_SOUND="PLAY_SOUND",Sounds.audioFiles={MENU_LOOP:"./audio/loop.mp3"};var StringFormatter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"formatPhone",value:function(e){return(e+"").replace(/[() -]*(?:\d?)[() -.]*(\d{3})[() -.]*(\d{3})[() -.]*(\d{4})[() -]*/,"($1) $2-$3")}},{key:"formatSSN",value:function(e){return(e+"").replace(/(\d{3})[ -]*(\d{2})[ -]*(\d{4})/,"$1-$2-$3")}},{key:"formatCreditCard",value:function(e){return(e+"").replace(/(\d{4})[ -]*(\d{4})[ -]*(\d{4})[ -]*(\d{4})/,"$1 $2 $3 $4")}},{key:"formatNumber",value:function(e){var t=e.match(/\d+\.?\d+/);return t&&0<t.length?t[0]:e}},{key:"formatDollarsCents",value:function(e){var t;if(1===(t=(e+"").split(".")).length)t.push("00");else{for(;t[1].length<2;)t[1]+="0";t[1]=t[1].substr(0,2)}return"$"+t.join(".")}},{key:"addCommasToNumber",value:function(e){for(var t=(e+"").split("."),i=t[0],n=1<t.length?"."+t[1]:"",a=/(\d+)(\d{3})/;a.test(i);)i=i.replace(a,"$1,$2");return i+n}},{key:"timeFromSeconds",value:function(e,t,i){var n=1<arguments.length&&void 0!==t&&t,a=2<arguments.length&&void 0!==i&&i,r=Math.floor(e/60/60),s=Math.floor(e%3600/60),o=Math.floor(e%1*100),l=Math.floor(e%60);return(n?(r<10?"0":"")+r+":":"")+((s<10?"0":"")+s)+":"+((l<10?"0":"")+l)+(a?":"+((o<10?"0":"")+o):"")}},{key:"replaceLineBreaksWithString",value:function(e,t){return e.replace(/(\r\n|\n|\r)/gm,t)}},{key:"removeCharacterAtIndex",value:function(e,t){return part1=e.substring(0,t),part2=e.substring(t+1,e.length),part1+part2}}]),e}(),SVGUtil=function(){function s(){_classCallCheck(this,s)}return _createClass(s,null,[{key:"rasterizeSVG",value:function(e,i,n){var t=(new XMLSerializer).serializeToString(e),a=s.dataImgPrefix+window.btoa(t),r=new Image;r.onload=function(){if(n){var e=s.drawImageToNewCanvas(r,!0);i(e.toDataURL("image/jpeg",n))}else{var t=s.drawImageToNewCanvas(r);i(t.toDataURL("image/png"))}},r.src=a}},{key:"drawImageToNewCanvas",value:function(e,t){var i=document.createElement("canvas");i.width=e.width,i.height=e.height;var n=i.getContext("2d");return t&&(n.fillStyle="#fff",n.fillRect(0,0,i.width,i.height)),n.drawImage(e,0,0),i}},{key:"elementToString",value:function(e){return e.outerHTML}},{key:"setBase64ImageOnSvgImage",value:function(e,t){e.removeAttributeNS("http://www.w3.org/1999/xlink","href"),e.setAttributeNS("http://www.w3.org/1999/xlink","href",t)}},{key:"svgStrToBase64",value:function(e){return"data:image/svg+xml;base64,"+btoa(e)}},{key:"svgElToBase64",value:function(e,t){return s.svgStrToBase64(e.outerHTML)}}]),s}();SVGUtil.clearColor="rgba(0,0,0,0)",SVGUtil.dataImgPrefix="data:image/svg+xml;base64,",SVGUtil.testSVG='<svg xmlns="http://www.w3.org/2000/svg" height="100" width="100"><circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="red"/></svg>',SVGUtil.testSVG2='<svg xmlns="http://www.w3.org/2000/svg" height="100" width="100"><rect x="10" y="10" width="80" height="80" stroke="black" stroke-width="3" fill="red"/></svg>';var ThreeScene=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:16777215,i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,n),this.el=e,this.elSize=this.el.getBoundingClientRect(),this.bgColor=t,this.transparent=i,this.devicePixelRatio=window.devicePixelRatio||1,this.buildScene(),this.buildRenderer(),this.addToDOM()}return _createClass(n,[{key:"buildScene",value:function(){this.scene=new THREE.Scene,this.getContainerSize(),this.VIEW_ANGLE=45,this.NEAR=.1,this.FAR=2e4,this.camera=new THREE.PerspectiveCamera(this.VIEW_ANGLE,this.ASPECT,this.NEAR,this.FAR),this.scene.add(this.camera),this.camera.position.set(0,0,400),this.camera.lookAt(this.scene.position)}},{key:"buildRenderer",value:function(){var e={antialias:!0};this.transparent&&(e.alpha=!0),this.renderer=new THREE.WebGLRenderer(e),this.renderer.setClearColor(this.bgColor,this.transparent?0:1),this.renderer.setPixelRatio(this.devicePixelRatio),this.renderer.setSize(this.elSize.width,this.elSize.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap}},{key:"buildLights",value:function(){var e=new THREE.AmbientLight(4473924);this.scene.add(e)}},{key:"addToDOM",value:function(){this.container=document.createElement("div"),this.el.appendChild(this.container),this.container.appendChild(this.renderer.domElement)}},{key:"getScene",value:function(){return this.scene}},{key:"getCamera",value:function(){return this.camera}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"getContainerSize",value:function(){this.elSize=this.el.getBoundingClientRect(),this.ASPECT=this.elSize.width/this.elSize.height}},{key:"resize",value:function(){this.fitToHtmlContainer(),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix()}},{key:"fitToHtmlContainer",value:function(){this.getContainerSize(),this.container.style.width=this.elSize.width+"px",this.container.style.height=this.elSize.height+"px",this.renderer.setSize(window.innerWidth,window.innerHeight)}}]),n}(),ThreeSceneAr=function(){function a(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body,i=1<arguments.length?arguments[1]:void 0,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return _classCallCheck(this,a),(e=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,t,0,!0))).cameraSource=i.cameraSource,e.arCameraData=i.arCameraData,e.arMarkerPatt=i.arMarkerPatt,e.markerActiveCallback=i.markerActiveCallback||null,e.lighting=i.lighting||{},e.debug=n,e.active=!1,e.buildArCameraSource(),e.buildArCV(),e.buildMarkerConfig(),e.buildSmoothedArControls(),e.buildShadowPlane(),e.buildLights(),e.debug&&e.addTestCube(),e}return _inherits(a,ThreeScene),_createClass(a,[{key:"buildArCameraSource",value:function(){var e=this,t=this.cameraSource==a.WEBCAM?{sourceType:"webcam"}:{sourceType:"image",sourceUrl:this.cameraSource};this.arToolkitSource=new THREEx.ArToolkitSource(t),this.arToolkitSource.init(function(){e.debug&&console.log("AR.js ready!"),e.resize(),setTimeout(function(){window.dispatchEvent(new Event("resize"))},200)})}},{key:"buildArCV",value:function(){var e=this;this.arToolkitContext=new THREEx.ArToolkitContext({debug:this.debug,cameraParametersUrl:this.arCameraData,detectionMode:"mono",maxDetectionRate:30}),this.arToolkitContext.init(function(){e.camera.projectionMatrix.copy(e.arToolkitContext.getProjectionMatrix())})}},{key:"buildMarkerConfig",value:function(){this.markerRoot=new THREE.Group,this.markerControls1=new THREEx.ArMarkerControls(this.arToolkitContext,this.markerRoot,{type:"pattern",patternUrl:this.arMarkerPatt})}},{key:"buildSmoothedArControls",value:function(){var e=this;this.arRoot=new THREE.Group,this.scene.add(this.arRoot),this.arSmoothControls=new THREEx.ArSmoothedControls(this.arRoot,{lerpPosition:.3,lerpQuaternion:.3,lerpScale:.3,minVisibleDelay:.2,minUnvisibleDelay:.5}),this.arSmoothControls.addEventListener("becameVisible",function(){e.active=!0,e.markerActiveCallback&&e.markerActiveCallback(e.active),e.debug&&console.log("becameVisible event notified")}),this.arSmoothControls.addEventListener("becameUnVisible",function(){e.active=!1,e.markerActiveCallback&&e.markerActiveCallback(e.active),e.debug&&console.log("becameUnVisible event notified")})}},{key:"buildScene",value:function(){this.scene=new THREE.Scene,this.camera=new THREE.Camera,this.scene.add(this.camera)}},{key:"buildLights",value:function(){var e=this.lighting.ambientColor?this.lighting.ambientColor:13421772,t=this.lighting.ambientIntensity?this.lighting.ambientIntensity:.65,i=new THREE.AmbientLight(e,t);this.scene.add(i);var n=this.lighting.lightHemiSkyColor?this.lighting.lightHemiSkyColor:10066329,a=this.lighting.lightHemiGroundColor?this.lighting.lightHemiGroundColor:16777215,r=this.lighting.lightHemiIntensity?this.lighting.lightHemiIntensity:.65;this.lightHemisphere=new THREE.HemisphereLight(n,a,r),this.scene.add(this.lightHemisphere);var s=this.lighting.lightDirectionalColor?this.lighting.lightDirectionalColor:16777215,o=this.lighting.lightDirectionalIntensity?this.lighting.lightDirectionalIntensity:.5,l=this.lighting.lightDirectionalX?this.lighting.lightDirectionalX:2,u=this.lighting.lightDirectionalY?this.lighting.lightDirectionalY:3,h=this.lighting.lightDirectionalZ?this.lighting.lightDirectionalZ:1;this.lightDirectional=new THREE.DirectionalLight(s,o),this.lightDirectional.position.set(l,u,h),this.scene.add(this.lightDirectional)}},{key:"buildShadowPlane",value:function(){var e=this.lighting.shadowPlaneSize?this.lighting.shadowPlaneSize:15,t=this.lighting.shadowOpacity?this.lighting.shadowOpacity:.5;this.shadowPlane=new THREE.Mesh(new THREE.PlaneBufferGeometry(e,e),new THREE.ShadowMaterial({opacity:t})),this.shadowPlane.rotation.x=-Math.PI/2,this.shadowPlane.receiveShadow=!0,this.shadowPlane.depthWrite=!1,this.shadowPlane.position.set(0,-.05,0),this.arRoot.add(this.shadowPlane);var i=this.lighting.shadowLightX?this.lighting.shadowLightX:1,n=this.lighting.shadowLightY?this.lighting.shadowLightY:6,a=this.lighting.shadowLightZ?this.lighting.shadowLightZ:0,r=this.lighting.shadowSpotlightAngle?this.lighting.shadowSpotlightAngle:.5,s=this.lighting.shadowMapSize?this.lighting.shadowMapSize:1024;this.spotlight=new THREE.SpotLight(16777215),this.spotlight.position.set(i,n,a),this.spotlight.target=this.shadowPlane,this.spotlight.castShadow=!0,this.spotlight.shadow.mapSize.width=s,this.spotlight.shadow.mapSize.height=s,this.spotlight.penumbra=.01,this.spotlight.decay=1,this.spotlight.angle=r,this.spotlight.distance=n+1,this.arRoot.add(this.spotlight)}},{key:"getScene",value:function(){return this.scene}},{key:"getArRoot",value:function(){return this.arRoot}},{key:"render",value:function(){this.arSmoothControls.update(this.markerRoot),!1!==this.arToolkitSource.ready&&this.arToolkitContext.update(this.arToolkitSource.domElement),_get(_getPrototypeOf(a.prototype),"render",this).call(this)}},{key:"resize",value:function(){this.fitToHtmlContainer(),this.arToolkitSource.onResizeElement(),this.arToolkitSource.copyElementSizeTo(this.renderer.domElement),null!==this.arToolkitContext.arController&&this.arToolkitSource.copyElementSizeTo(this.arToolkitContext.arController.canvas)}},{key:"addTestCube",value:function(){var e=new THREE.Mesh(new THREE.CubeGeometry(1,1,1),new THREE.MeshNormalMaterial({transparent:!0,opacity:.5,side:THREE.DoubleSide}));e.position.y=.5,this.arRoot.add(e)}}]),a}();ThreeSceneAr.WEBCAM="webcam";var URLUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getHashQueryVariable",value:function(e){for(var t=decodeURIComponent(window.location.hash.substring(1)).split("&"),i=0;i<t.length;i++){var n=t[i].split("=");if(decodeURIComponent(n[0])==e)return decodeURIComponent(n[1])}return null}}]),e}(),UserInteractionTimeout=function(){function r(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3,n=2<arguments.length?arguments[2]:void 0,a=3<arguments.length?arguments[3]:void 0;_classCallCheck(this,r),this.el=e,this.millis=i,this.completeCallback=n,this.interactedCallback=a,this.events=["mousedown","touchstart","mousemove","touchmove","mouseup","touchend","scroll"],this.events.forEach(function(e){t.el.addEventListener(e,function(e){return t.interacted()})})}return _createClass(r,[{key:"interacted",value:function(e){var t=this;this.interactedCallback&&this.interactedCallback(),window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){t.completeCallback&&t.completeCallback()},this.millis)}}]),r}(),VideoToBlob=function(){function i(e,t){_classCallCheck(this,i),this.callback=t,this.loadVideo(e)}return _createClass(i,[{key:"loadFile",value:function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.send(),i.onload=function(){200!==i.status&&console.warn("VideoToBlob.loadFile() :: Unexpected status code "+i.status+" for "+e),t(new Uint8Array(i.response))}}},{key:"loadVideo",value:function(e){var n=this,a=e.match(/mp4/gi)?"video/mp4":"video/webm";this.loadFile(e,function(e){var t=new Blob([e],{type:a}),i=document.createElement("video");i.defaultMuted=!0,i.setAttribute("muted","true"),i.setAttribute("preload","auto"),i.setAttribute("playsinline","true"),i.setAttribute("crossOrigin","anonymous"),i.setAttribute("loop","true"),i.src=URL.createObjectURL(t),i.setAttribute("muted","true"),i.muted=!0,i.volume=0,n.callback(i)})}}]),i}();